<!DOCTYPE html>
<html>
<head>
    <title>Letter Rendering Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        canvas { border: 1px solid black; margin: 10px 0; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h1>Letter Rendering Test</h1>
    <div id="results"></div>

    <canvas id="testCanvas" width="400" height="100"></canvas>

    <script>
        const results = document.getElementById('results');
        const canvas = document.getElementById('testCanvas');
        const ctx = canvas.getContext('2d');

        function addResult(message, isSuccess = true) {
            const div = document.createElement('div');
            div.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            div.textContent = message;
            results.appendChild(div);
        }

        function testLetterRendering() {
            addResult('Testing letter rendering...');

            // Test pixels with letters
            const testPixels = [
                { x: 10, y: 10, color: '#ff0000', letter: 'A' },
                { x: 30, y: 10, color: '#ffffff', letter: 'B' }, // White background
                { x: 50, y: 10, color: '#000000', letter: 'C' }, // Black background
                { x: 70, y: 10, color: '#ffff00', letter: 'D' }, // Yellow background
            ];

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw pixels with letters
            testPixels.forEach(pixel => {
                // Draw pixel background
                ctx.fillStyle = pixel.color;
                ctx.fillRect(pixel.x, pixel.y, 15, 15);

                // Draw letter if present
                if (pixel.letter) {
                    // Use black text for better visibility on light colors, white for dark colors
                    const colorBrightness = parseInt(pixel.color.slice(1), 16);
                    const isLightColor = colorBrightness > 0x7FFFFF; // Check if color is light
                    ctx.fillStyle = isLightColor ? '#000000' : '#ffffff';

                    // Use a minimum size to ensure visibility
                    const fontSize = Math.max(12, 8.0 / 1); // Assuming zoom = 1 for test
                    ctx.font = `${fontSize}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';

                    // Draw background circle for better visibility
                    const originalFillStyle = ctx.fillStyle;
                    ctx.fillStyle = pixel.color === '#ffffff' ? '#000000' : '#ffffff';
                    ctx.beginPath();
                    ctx.arc(pixel.x + 7.5, pixel.y + 7.5, 6, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.fillStyle = originalFillStyle;

                    ctx.fillText(pixel.letter, pixel.x + 7.5, pixel.y + 7.5);
                }
            });

            addResult('âœ… Letter rendering test completed - check the canvas above');
            addResult('You should see letters A, B, C, D on colored squares with background circles');
        }

        // Run the test
        testLetterRendering();
    </script>
</body>
</html>